<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø·Ø±ÙŠÙ‚ Ø§Ù„ÙŠÙ‚ÙŠÙ† - Sryoss AlYaqeen</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #0d4d2f;
            --secondary-green: #1a6b47;
            --light-green: #2d8a5e;
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --dark-overlay: rgba(0, 0, 0, 0.3);
            --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.25);
        }

        body {
            font-family: 'Cairo', 'Amiri', sans-serif;
            background: linear-gradient(180deg, var(--primary-green) 0%, var(--secondary-green) 50%, var(--light-green) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            max-width: 430px;
            margin: 0 auto;
            padding-bottom: 10px;
        }

        /* Header Section */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-icon svg {
            width: 24px;
            height: 24px;
            fill: #fff;
        }

        /* GPS Icon States */
        .gps-icon {
            transition: all 0.3s ease;
        }

        .gps-icon:active {
            transform: scale(0.9);
        }

        .gps-icon.loading svg {
            animation: pulse 1s ease-in-out infinite;
        }

        .gps-icon.success svg {
            fill: #4CAF50;
        }

        .gps-icon.error svg {
            fill: #f44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* GPS Notification Banner */
        .gps-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(13, 77, 47, 0.98) 0%, rgba(26, 107, 71, 0.98) 100%);
            border-radius: 16px;
            padding: 24px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            text-align: center;
            max-width: 320px;
            width: 90%;
            border: 2px solid var(--gold);
            display: none;
        }

        .gps-notification.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .gps-notification-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .gps-notification-title {
            font-family: 'Amiri', serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 12px;
        }

        .gps-notification-message {
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .gps-notification-btn {
            background: linear-gradient(145deg, var(--gold) 0%, #c4a030 100%);
            color: var(--primary-green);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gps-notification-btn:active {
            transform: scale(0.95);
        }

        .gps-notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            display: none;
        }

        .gps-notification-overlay.show {
            display: block;
        }

        .header-title {
            text-align: center;
            flex: 1;
        }

        .header-title .arabic {
            font-family: 'Amiri', serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: block;
        }

        .header-title .english {
            font-family: 'Cairo', sans-serif;
            font-size: 11px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.85);
            letter-spacing: 1px;
            display: block;
            margin-top: 2px;
        }

        /* Hero Section */
        .hero {
            position: relative;
            width: 100%;
            height: 160px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
        }

        .hero img::before {
            content: 'Loading image...';
            display: block;
            text-align: center;
            padding-top: 100px;
            color: white;
        }

        .hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(to top, var(--secondary-green) 0%, transparent 100%);
        }

        /* Main Grid Section */
        .grid-section {
            padding: 0 12px;
            margin-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .grid-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 10px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .grid-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold) 100%);
        }

        .grid-card:active {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--card-shadow-hover);
        }

        .grid-card .icon {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .grid-card .label {
            font-family: 'Cairo', sans-serif;
            font-size: 12px;
            font-weight: 500;
            color: #fff;
            text-align: center;
        }

        /* Full Width Card */
        .full-width-section {
            padding: 0 12px;
            margin-bottom: 10px;
        }

        .full-width-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .full-width-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold) 100%);
        }

        .full-width-card:active {
            transform: translateY(-3px) scale(1.01);
            box-shadow: var(--card-shadow-hover);
        }

        .full-width-card .icon {
            font-size: 18px;
        }

        .full-width-card .label {
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: #fff;
        }

        /* Prayer Times Panel */
        .prayer-section {
            padding: 0 12px;
            margin-bottom: 10px;
        }

        .prayer-panel {
            background: linear-gradient(145deg, var(--primary-green) 0%, var(--secondary-green) 100%);
            border-radius: 14px;
            padding: 14px 10px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .prayer-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold) 100%);
        }

        .prayer-times {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .prayer-item {
            text-align: center;
            flex: 1;
        }

        .prayer-name {
            font-family: 'Amiri', serif;
            font-size: 11px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 3px;
        }

        .prayer-time {
            font-family: 'Cairo', sans-serif;
            font-size: 10px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .countdown {
            text-align: center;
            padding-top: 8px;
            border-top: 1px solid rgba(212, 175, 55, 0.3);
        }

        .countdown-text {
            font-family: 'Cairo', sans-serif;
            font-size: 10px;
            font-weight: 500;
            color: var(--gold);
        }

        .countdown-time {
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--gold-light);
            margin-top: 3px;
            letter-spacing: 1px;
        }

        /* AdMob Banner Space */
        .admob-banner-space {
            width: 100%;
            height: 50px;
            background: linear-gradient(145deg, var(--secondary-green) 0%, var(--light-green) 100%);
            margin-top: 10px;
            position: relative;
        }

        /* Decorative Elements */
        .pattern-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L60 30L30 60L0 30L30 0z' fill='%23d4af37' fill-opacity='1'/%3E%3C/svg%3E");
            z-index: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 380px) {
            .header-title .arabic {
                font-size: 16px;
            }

            .header {
                padding: 8px 12px;
            }

            .grid-card .icon {
                font-size: 18px;
            }

            .grid-card .label {
                font-size: 11px;
            }

            .grid-card {
                padding: 8px 6px;
            }

            .prayer-name {
                font-size: 10px;
            }

            .prayer-time {
                font-size: 9px;
            }

            .countdown-text {
                font-size: 9px;
            }

            .countdown-time {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="pattern-overlay"></div>

    <!-- GPS Notification Overlay -->
    <div class="gps-notification-overlay" id="gpsOverlay"></div>
    <div class="gps-notification" id="gpsNotification">
        <div class="gps-notification-icon" id="gpsNotificationIcon">ğŸ“</div>
        <div class="gps-notification-title" id="gpsNotificationTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div>
        <div class="gps-notification-message" id="gpsNotificationMessage">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div>
        <button class="gps-notification-btn" id="gpsNotificationBtn">Ù…ÙˆØ§ÙÙ‚</button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-icon gps-icon" id="gpsIcon" style="cursor: pointer;" title="ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C8.5 2 5.5 4 4 7c0 3.5 2.5 6 4 8.5C9.5 18 11 21 12 22c1-1 2.5-4 4-6.5 1.5-2.5 4-5 4-8.5-1.5-3-4.5-5-8-5zm0 9c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                    <path d="M6 22h12v-2H6v2z"/>
                </svg>
            </div>
            <div class="header-title">
                <span class="arabic">Ø·Ø±ÙŠÙ‚ Ø§Ù„ÙŠÙ‚ÙŠÙ†</span>
                <span class="english">Sryoss AlYaqeen</span>
            </div>
            <div class="header-icon" onclick="window.location.href='settings.html'" style="cursor: pointer;">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                </svg>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <img src="https://www.casablancacity.ma/couvertures/article/Wf8vz0O0gh7zlEYcXDx6cBX3Tbl1buNqkBgX2JSw.png" alt="Islamic App Banner">
            <div class="hero-overlay"></div>
        </section>

        <!-- Main Grid -->
        <section class="grid-section">
            <div class="grid">
                <div class="grid-card" onclick="window.location.href='quran.html'">
                    <div class="icon">ğŸ“–</div>
                    <div class="label">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
                </div>
                <div class="grid-card" onclick="window.location.href='adhkar.html'">
                    <div class="icon">ğŸ¤²</div>
                    <div class="label">Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</div>
                </div>
                <div class="grid-card" onclick="window.location.href='qibla.html'">
                    <div class="icon">ğŸ§­</div>
                    <div class="label">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©</div>
                </div>
                <div class="grid-card" onclick="window.location.href='hadith.html'">
                    <div class="icon">ğŸ“œ</div>
                    <div class="label">Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</div>
                </div>
                <div class="grid-card" onclick="window.location.href='salat.html'">
                    <div class="icon">ğŸ•Œ</div>
                    <div class="label">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</div>
                </div>
                <div class="grid-card" onclick="window.location.href='zakat.html'">
                    <div class="icon">ğŸ’°</div>
                    <div class="label">Ø§Ù„Ø²ÙƒØ§Ø©</div>
                </div>
            </div>
        </section>

        <!-- Full Width Card -->
        <section class="full-width-section">
            <div class="full-width-card" onclick="window.location.href='asmaul-husna.html'">
                <div class="icon">âœ¨</div>
                <div class="label">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</div>
                <div class="icon">âœ¨</div>
            </div>
        </section>

        <!-- Prayer Times Panel -->
        <section class="prayer-section">
            <div class="prayer-panel">
                <div class="prayer-times">
                    <div class="prayer-item">
                        <div class="prayer-name">Ø§Ù„ÙØ¬Ø±</div>
                        <div class="prayer-time" id="fajr-time">06:44</div>
                    </div>
                    <div class="prayer-item">
                        <div class="prayer-name">Ø§Ù„Ø¸Ù‡Ø±</div>
                        <div class="prayer-time" id="dhuhr-time">13:16</div>
                    </div>
                    <div class="prayer-item">
                        <div class="prayer-name">Ø§Ù„Ø¹ØµØ±</div>
                        <div class="prayer-time" id="asr-time">15:53</div>
                    </div>
                    <div class="prayer-item">
                        <div class="prayer-name">Ø§Ù„Ù…ØºØ±Ø¨</div>
                        <div class="prayer-time" id="maghrib-time">18:09</div>
                    </div>
                    <div class="prayer-item">
                        <div class="prayer-name">Ø§Ù„Ø¹Ø´Ø§Ø¡</div>
                        <div class="prayer-time" id="isha-time">19:38</div>
                    </div>
                </div>
                <div class="countdown">
                    <div class="countdown-text" id="countdownText">Ù…ØªØ¨Ù‚ÙŠ Ø­ØªÙ‰ Ø§Ù„ÙØ¬Ø±</div>
                    <div class="countdown-time" id="countdown">00:00:00</div>
                </div>
            </div>
        </section>

        <!-- AdMob Banner Space -->
        <section class="admob-banner-space">
            <!-- AdMob Banner will be displayed here -->
        </section>
    </div>

    <script>
        // Tetouan, Morocco coordinates (default)
        const TETOUAN_COORDS = {
            latitude: 35.5889,
            longitude: -5.3626
        };

        // Current location (default to Tetouan)
        let currentLocation = {
            latitude: TETOUAN_COORDS.latitude,
            longitude: TETOUAN_COORDS.longitude,
            source: 'default' // 'default', 'gps', 'manual'
        };

        // Prayer Times Data
        let prayerTimes = {
            Fajr: null,
            Dhuhr: null,
            Asr: null,
            Maghrib: null,
            Isha: null
        };

        // Countdown Timer
        let countdownInterval;

        // ==================== GPS Notification System ====================

        function showGPSNotification(icon, title, message, btnText, callback) {
            const overlay = document.getElementById('gpsOverlay');
            const notification = document.getElementById('gpsNotification');
            const iconEl = document.getElementById('gpsNotificationIcon');
            const titleEl = document.getElementById('gpsNotificationTitle');
            const messageEl = document.getElementById('gpsNotificationMessage');
            const btn = document.getElementById('gpsNotificationBtn');

            iconEl.textContent = icon;
            titleEl.textContent = title;
            messageEl.textContent = message;
            btn.textContent = btnText;

            // Remove old event listeners
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);

            // Add click handler
            newBtn.addEventListener('click', function() {
                hideGPSNotification();
                if (callback) callback();
            });

            overlay.classList.add('show');
            notification.classList.add('show');
        }

        function hideGPSNotification() {
            const overlay = document.getElementById('gpsOverlay');
            const notification = document.getElementById('gpsNotification');
            overlay.classList.remove('show');
            notification.classList.remove('show');
        }

        // ==================== GPS Location Functions ====================

        function setGPSIconState(state) {
            const gpsIcon = document.getElementById('gpsIcon');
            gpsIcon.classList.remove('loading', 'success', 'error');
            if (state) gpsIcon.classList.add(state);
        }

        function handleGPSError(errorCode) {
            setGPSIconState('error');

            let title = '';
            let message = '';

            switch(errorCode) {
                case 1: // PERMISSION_DENIED
                    title = 'âš ï¸ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨';
                    message = 'Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø¨Ø¯Ù‚Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.';
                    break;
                case 2: // POSITION_UNAVAILABLE
                    title = 'ğŸ“¡ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                    message = 'ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS) ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                    break;
                case 3: // TIMEOUT
                    title = 'â±ï¸ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©';
                    message = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                    break;
                default:
                    title = 'âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
                    message = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
            }

            showGPSNotification('ğŸ“', title, message, 'Ø­Ø³Ù†Ø§Ù‹', function() {
                setGPSIconState('');
            });
        }

        function onGPSSuccess(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // Update current location
            currentLocation = {
                latitude: lat,
                longitude: lng,
                source: 'gps'
            };

            // Save to localStorage for other pages
            localStorage.setItem('autoLocation', JSON.stringify({
                lat: lat,
                lng: lng,
                accuracy: accuracy
            }));
            localStorage.setItem('locationMode', 'auto');
            localStorage.removeItem('selectedCity');

            // Update prayer times with new location
            calculatePrayerTimes(lat, lng);

            // Show success notification
            setGPSIconState('success');
            showGPSNotification(
                'âœ…',
                'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­',
                `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.\nØ§Ù„Ø¯Ù‚Ø©: ${Math.round(accuracy)} Ù…ØªØ±`,
                'Ø­Ø³Ù†Ø§Ù‹',
                function() {
                    setTimeout(() => setGPSIconState(''), 2000);
                }
            );
        }

        function requestGPSSystem() {
            // Check if geolocation is supported
            if (!navigator.geolocation) {
                showGPSNotification(
                    'âŒ',
                    'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…',
                    'Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø£Ø­Ø¯Ø«.',
                    'Ø­Ø³Ù†Ø§Ù‹'
                );
                return;
            }

            setGPSIconState('loading');

            // Request location with high accuracy
            navigator.geolocation.getCurrentPosition(
                onGPSSuccess,
                function(error) {
                    handleGPSError(error.code);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }

        function checkGPSEnabled(callback) {
            // Try to get position quickly to check if GPS is on
            if (!navigator.geolocation) {
                callback(false);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function() {
                    callback(true);
                },
                function(error) {
                    if (error.code === 2 || error.code === 3) {
                        // POSITION_UNAVAILABLE or TIMEOUT usually means GPS is off
                        callback(false);
                    } else {
                        callback(true); // Permission denied but GPS is on
                    }
                },
                {
                    enableHighAccuracy: true,
                    timeout: 3000,
                    maximumAge: 0
                }
            );
        }

        function onGPSClick() {
            // Check if we already have permission
            if (navigator.permissions) {
                navigator.permissions.query({ name: 'geolocation' })
                    .then(function(result) {
                        if (result.state === 'granted') {
                            // Permission already granted, get location
                            requestGPSSystem();
                        } else if (result.state === 'denied') {
                            // Permission was denied, show explanation
                            setGPSIconState('error');
                            showGPSNotification(
                                'âš ï¸',
                                'Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨',
                                'Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø¨Ø¯Ù‚Ø©.\n\nÙ„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø°Ù†:\n1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­\n2. Ø§Ø¨Ø­Ø« Ø¹Ù† "Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹"\n3. ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø°Ù† Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚',
                                'Ø­Ø³Ù†Ø§Ù‹',
                                function() {
                                    setGPSIconState('');
                                }
                            );
                        } else {
                            // Permission not yet requested (prompt state)
                            checkGPSEnabled(function(gpsEnabled) {
                                if (!gpsEnabled) {
                                    showGPSNotification(
                                        'ğŸ“¡',
                                        'ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹',
                                        'ÙŠØ±Ø¬Ù‰ ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS) ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.',
                                        'Ø­Ø³Ù†Ø§Ù‹'
                                    );
                                } else {
                                    requestGPSSystem();
                                }
                            });
                        }
                    })
                    .catch(function() {
                        // Permissions API not supported, try directly
                        requestGPSSystem();
                    });
            } else {
                // Permissions API not supported, try directly
                requestGPSSystem();
            }
        }

        // ==================== Prayer Times Calculation ====================

        function calculatePrayerTimes(lat, lng) {
            // Simplified prayer times calculation based on location
            const now = new Date();
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));

            // Base time adjustments by latitude
            const latOffset = (lat - 30) * 2;
            const lngOffset = (lng + 5) * 0.5;

            // Seasonal adjustment
            const seasonalAdjustment = Math.sin((dayOfYear / 365) * Math.PI * 2) * 30;

            // Base prayer times
            const baseTimes = {
                Fajr: { hour: 5, minute: 30 },
                Dhuhr: { hour: 12, minute: 30 },
                Asr: { hour: 15, minute: 30 },
                Maghrib: { hour: 18, minute: 0 },
                Isha: { hour: 19, minute: 30 }
            };

            function formatTime(hour, minute, adjustMinutes) {
                let totalMinutes = hour * 60 + minute + adjustMinutes;
                totalMinutes = Math.round(totalMinutes);
                let h = Math.floor(totalMinutes / 60);
                let m = totalMinutes % 60;
                if (h < 0) h += 24;
                if (h >= 24) h -= 24;
                return String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0');
            }

            prayerTimes.Fajr = formatTime(baseTimes.Fajr.hour, baseTimes.Fajr.minute, latOffset + seasonalAdjustment - 20);
            prayerTimes.Dhuhr = formatTime(baseTimes.Dhuhr.hour, baseTimes.Dhuhr.minute, lngOffset + seasonalAdjustment);
            prayerTimes.Asr = formatTime(baseTimes.Asr.hour, baseTimes.Asr.minute, latOffset + lngOffset + seasonalAdjustment + 30);
            prayerTimes.Maghrib = formatTime(baseTimes.Maghrib.hour, baseTimes.Maghrib.minute, latOffset + seasonalAdjustment + 10);
            prayerTimes.Isha = formatTime(baseTimes.Isha.hour, baseTimes.Isha.minute, latOffset + seasonalAdjustment + 40);

            updatePrayerDisplay();
            updateCountdown();
        }

        function fetchPrayerTimes() {
            // Check if there's a saved location from localStorage
            const savedMode = localStorage.getItem('locationMode');
            const savedAutoLocation = localStorage.getItem('autoLocation');
            const savedCity = localStorage.getItem('selectedCity');

            if (savedMode === 'auto' && savedAutoLocation) {
                try {
                    const locationData = JSON.parse(savedAutoLocation);
                    currentLocation = {
                        latitude: locationData.lat,
                        longitude: locationData.lng,
                        source: 'gps'
                    };
                    setGPSIconState('success');
                } catch (e) {
                    // Use default
                }
            } else if (savedMode === 'manual' && savedCity) {
                currentLocation.source = 'manual';
            }

            // Calculate prayer times for current location
            calculatePrayerTimes(currentLocation.latitude, currentLocation.longitude);
        }

        function updatePrayerDisplay() {
            document.getElementById('fajr-time').textContent = prayerTimes.Fajr || '--:--';
            document.getElementById('dhuhr-time').textContent = prayerTimes.Dhuhr || '--:--';
            document.getElementById('asr-time').textContent = prayerTimes.Asr || '--:--';
            document.getElementById('maghrib-time').textContent = prayerTimes.Maghrib || '--:--';
            document.getElementById('isha-time').textContent = prayerTimes.Isha || '--:--';
        }

        function updateCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            countdownInterval = setInterval(() => {
                const now = new Date();
                const nextPrayer = getNextPrayer();
                const nextPrayerTime = parsePrayerTime(nextPrayer.time);
                const nextPrayerDate = new Date();
                nextPrayerDate.setHours(nextPrayerTime.hours, nextPrayerTime.minutes, 0);

                if (nextPrayerDate < now) {
                    nextPrayerDate.setDate(nextPrayerDate.getDate() + 1);
                }

                const diff = nextPrayerDate - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdown').textContent =
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');

                const prayerNames = {
                    'Fajr': 'Ø§Ù„ÙØ¬Ø±',
                    'Dhuhr': 'Ø§Ù„Ø¸Ù‡Ø±',
                    'Asr': 'Ø§Ù„Ø¹ØµØ±',
                    'Maghrib': 'Ø§Ù„Ù…ØºØ±Ø¨',
                    'Isha': 'Ø§Ù„Ø¹Ø´Ø§Ø¡'
                };
                document.querySelector('.countdown-text').textContent = `Ù…ØªØ¨Ù‚ÙŠ Ø­ØªÙ‰ ${prayerNames[nextPrayer.name]}`;
            }, 1000);
        }

        function getNextPrayer() {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const prayers = [
                { name: 'Fajr', time: prayerTimes.Fajr },
                { name: 'Dhuhr', time: prayerTimes.Dhuhr },
                { name: 'Asr', time: prayerTimes.Asr },
                { name: 'Maghrib', time: prayerTimes.Maghrib },
                { name: 'Isha', time: prayerTimes.Isha }
            ];

            for (const prayer of prayers) {
                const prayerTime = parsePrayerTime(prayer.time);
                const prayerMinutes = prayerTime.hours * 60 + prayerTime.minutes;
                if (prayerMinutes > currentMinutes) {
                    return prayer;
                }
            }

            return prayers[0];
        }

        function parsePrayerTime(timeString) {
            if (!timeString) return { hours: 0, minutes: 0 };
            const [hours, minutes] = timeString.split(':').map(Number);
            return { hours, minutes };
        }

        // ==================== Initialize ====================

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize prayer times
            fetchPrayerTimes();

            // Add click event to GPS icon
            const gpsIcon = document.getElementById('gpsIcon');
            if (gpsIcon) {
                gpsIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    onGPSClick();
                });
            }

            // Add haptic feedback
            document.querySelectorAll('.grid-card, .full-width-card, .ad-button').forEach(function(element) {
                element.addEventListener('touchstart', function() {
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                });
            });

            // Disable text selection
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });

            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });
    </script>
</body>
</html>
